"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),DynamicFormObserver=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"rowWasCreated",value:function(e){}},{key:"rowWasRemoved",value:function(e){}}]),e}(),DynamicForms=function(){function e(){_classCallCheck(this,e),this.dynamic_elements={},this.elements={},this.templates={},this.observers=[]}return _createClass(e,[{key:"addObserver",value:function(e){this.observers.push(e)}},{key:"rowWasRemoved",value:function(e){for(var t in this.observers){var a=this.observers[t];void 0!==a.rowWasRemoved&&"function"==typeof a.rowWasRemoved?a.rowWasRemoved(e):console.log('[-] DynamicForms: observer function missing "rowWasRemoved"')}}},{key:"rowWasCreated",value:function(e){for(var t in this.observers){var a=this.observers[t];void 0!==a.rowWasCreated&&"function"==typeof a.rowWasCreated?a.rowWasCreated(e):console.log('[-] DynamicForms: observer function missing "rowWasCreated"')}}},{key:"automaticallySetupForm",value:function(){$("[data-dynamic-form] [data-dynamic-form-template]").each(function(e,t){var a=$(t),o=a.parent();this.setupForm(o,a)}.bind(this))}},{key:"setupForm",value:function(t,a){a.detach();var o=a.data("dynamic-form-fill");if(void 0===o)this.createNewRow(t,a);else if("string"!=typeof o){for(var n in o)o.hasOwnProperty(n)&&this.createNewRow(t,a,n,o[n]);this.createNewRow(t,a)}else this.createNewRow(t,a);e.handleButtons(t)}},{key:"createNewRow",value:function(t, a){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=a.clone(),r=a.data("dynamic-form-template");void 0===this.templates[r]?this.templates[r]=0:this.templates[r]++;var s=this.templates[r];i.removeAttr("data-dynamic-form-template"),i.removeAttr("data-dynamic-form-fill");var d=void 0;i.find("[data-dynamic-form-input-id-template]").each(function(t, a){var i=$(a),r=i.attr("name");d=void 0===this.dynamic_elements[r];var s=i.data("dynamic-form-input-id-template");if(void 0!==n){var m=i.data("dynamic-form-input-name");"string"==typeof n?i.val(n):"object"===(void 0===n?"undefined":_typeof(n))&&n.hasOwnProperty(m)&&i.val(n[m])}var c=void 0;void 0===o?(void 0===this.dynamic_elements[r]?this.dynamic_elements[r]=0:this.dynamic_elements[r]++,c=r.replace(s,e.numToChar(this.dynamic_elements[r]))):void 0!==o&&(void 0===this.elements[r]?this.elements[r]=0:this.elements[r]++,c=r.replace(s,this.elements[r])),i.attr("name",c)}.bind(this)),i.find("[data-dynamic-form-add]").each(function(o, n){var i=$(n);i.attr("data-dynamic-form-add",e.getDataTagForButton(r,"add",s)),i.click(function(){this.createNewRow(t,a),e.handleButtons(t)}.bind(this))}.bind(this)),i.find("[data-dynamic-form-remove]").each(function(a, n){var d=$(n);d.attr("data-dynamic-form-remove",e.getDataTagForButton(r,"remove",s)),d.click(function(){i.remove(),e.handleButtons(t),e.updateRemoveField(t,r,o),this.rowWasRemoved(i)}.bind(this))}.bind(this)),i.show(),i.appendTo(t),this.rowWasCreated(i)}}],[{key:"updateRemoveField",value:function(e, t, a){if(!isNaN(parseInt(a))&&isFinite(a))if(0===e.find("input[type='hidden']").length)e.prepend('<input type="hidden" name="remove_'+t+'" value="'+a+'" />');else{var o=$(e.find("input[type='hidden']")[0]),n=o.val();o.val(n+","+a)}}},{key:"getDataTagForButton",value:function(e, t, a){return e+"-"+t+"-"+a}},{key:"handleButtons",value:function(e){e.find("[data-dynamic-form-add]").each(function(e, t){$(t).hide()}),e.find("[data-dynamic-form-add]").last().show(),e.find("[data-dynamic-form-remove]").each(function(e, t){$(t).show()}),e.find("[data-dynamic-form-remove]").last().hide()}},{key:"numToChar",value:function(e){var t="abcdefghijklmnopqrstuvwxyz",a="";for(e++; e>0;){e--;var o=e%t.length;a=t[o]+a,e=(e-o)/t.length}return a}}]),e}();window.DynamicForms=DynamicForms,window.DynamicFormObserver=DynamicFormObserver;